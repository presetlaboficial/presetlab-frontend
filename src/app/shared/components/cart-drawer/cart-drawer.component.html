<div class="overlay" [class.visible]="isOpen$ | async" (click)="close()"></div>

<aside class="drawer" [class.open]="isOpen$ | async">
  <header class="drawer-header">
    <div class="header-title">
      <i class="fas fa-shopping-bag"></i>
      <h3>Seu Carrinho</h3>
    </div>
    <button class="btn-close" (click)="close()">
      <i class="fas fa-times"></i>
    </button>
  </header>

  <div class="items-container">
    <ng-container *ngIf="items$ | async as items">
      <div *ngIf="items.length === 0" class="empty-state">
        <i class="fas fa-shopping-cart empty-icon"></i>
        <p>Seu carrinho está vazio.</p>
        <button class="btn-continue" (click)="close()">
          Continuar comprando
        </button>
      </div>

      <ul *ngIf="items.length > 0" class="items-list">
        <li *ngFor="let item of items" class="cart-item">
          <div class="item-image">
            <img
              [src]="item.image || 'assets/placeholder.png'"
              [alt]="item.name"
            />
          </div>

          <div class="item-info">
            <span class="item-name">{{ item.name }}</span>
            <div class="item-meta">
              <span class="qty">Qtd: {{ item.quantity }}</span>
              <span class="price">{{ item.price | currency: "BRL" }}</span>
            </div>
          </div>

          <button
            class="btn-remove"
            (click)="remove(item.productId)"
            title="Remover item"
          >
            <i class="fas fa-trash-alt"></i>
          </button>
        </li>
      </ul>
    </ng-container>
  </div>

  <footer class="drawer-footer" *ngIf="cartTotal$ | async as total">
    <ng-container *ngIf="total > 0">
      <div class="total-row">
        <span>Subtotal</span>
        <strong class="total-value">{{ total | currency: "BRL" }}</strong>
      </div>

      <button
        class="btn-checkout"
        *ngIf="auth.user$ | async; else loginRequired"
        (click)="checkout()"
      >
        Finalizar Compra <i class="fas fa-arrow-right"></i>
      </button>

      <ng-template #loginRequired>
        <button class="btn-checkout btn-login" (click)="goToLogin()">
          <i class="fas fa-lock"></i> Faça login para finalizar
        </button>
      </ng-template>
    </ng-container>
  </footer>
</aside>
